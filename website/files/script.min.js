function validUser(e){return e.length<4||e.length>30?!1:e.match(/^[A-Za-z0-9\-_\.]+$/)?!0:!1}function password(e){var t="freetron",n=Sha256.hash(t+e);return n}function forgotMouseOver(){var e=$("forgotmsg");e.style.display="block"}function forgotMouseOut(){var e=$("forgotmsg");e.style.display="none"}function deleteAccount(){var e=confirm("Are you sure you want to delete your account? All of your data will be permanently removed.");if(e){var t=parseInt($("confirm").value,10);window.rpc.account_delete.on_result=function(e){e&&goHome()},window.rpc.account_delete(t)}return!1}function accountSubmit(){var e=$("user"),t=$("pass"),n=$("badlogin");if(validUser(e.value)&&t.value.length>0){n.style.display="none";var r=password(t.value);window.rpc.account_login.on_error=function(e){var t=$("badlogin");t.style.display="inline"},window.rpc.account_login.on_result=function(e){var t=$("badlogin");e?(t.style.display="none",goHome()):t.style.display="inline"},window.rpc.account_login(e.value,r)}else n.style.display="inline";return!1}function newAccountSubmit(){var e=$("badusername"),t=$("new_user"),n=$("new_pass"),r=t.value;if(!validUser(r))e.style.display="inline",t.className="new_user";else{e.style.display="none",t.className="field";var i=password(n.value);window.rpc.account_create.on_error=function(e){var t=$("badusername"),n=$("new_user");t.style.display="inline",n.className="new_user"},window.rpc.account_create.on_result=function(e){var t=$("badusername"),n=$("new_user");e?(t.style.display="none",n.className="field",goHome()):(t.style.display="inline",n.className="new_user")},window.rpc.account_create(t.value,i)}return!1}function updateAccountSubmit(){var e=$("badusernameupdate"),t=$("update_user"),n=$("update_pass"),r=t.value;if(!validUser(r))e.style.display="inline",t.className="new_user";else{e.style.display="none",t.className="field";var i=password(n.value);window.rpc.account_update.on_error=function(e){var t=$("badusernameupdate"),n=$("update_user");t.style.display="inline",n.className="new_user"},window.rpc.account_update.on_result=function(e){var t=$("badusernameupdate"),n=$("update_user"),r=$("update_pass");e?(t.style.display="none",n.className="field",r.value=""):(t.style.display="inline",n.className="new_user")},window.rpc.account_update(t.value,i)}return!1}function isPdf(e,t){return e==="application/pdf"||t.substr(-3,3).toLowerCase()==="pdf"}function validKey(e){return e.length<1||e.length>10?!1:e.match(/^[0-9]+$/)?!0:!1}function fileSelected(){var e=$("fileError"),t=$("uploadFile").files[0];t&&(isPdf(t.type,t.name)?e.innerHTML="":fileError("Must be PDF"))}function uploadFile(){var e=$("uploadFile").files[0],t=$("fileError"),n=$("progress"),r=$("uploadFileButton"),i=$("key").value;if(!e)fileError("Invalid file");else if(!validKey(i))fileError("Key must be a number");else if(!isPdf(e.type,e.name))fileError("Must be PDF");else{var s,o=$("upload");if(typeof o.getFormData=="function")s=o.getFormData();else{if(typeof FormData!="function")return!0;s=new FormData(o)}http("/upload/"+i,uploadComplete,function(e){fileError("Error uploading file")},uploadProgress,function(e){fileError("Canceled")},s),t.innerHTML="",r.disabled=!0,window.needToConfirm=!0,n.innerHTML="Uploading"}return!1}function monitorProcessing(e){window.rpc.form_process.on_error=function(e){e.error&&e.error.length>0?fileError("Error: "+e.error):fileError("Error processing file")},window.rpc.form_process.on_result=function(t){var n=$("progress");n.innerHTML="Processing: "+t.percent+"%",t["percent"]==100?($("upload").reset(),n.innerHTML="Done",formGetOne(e),setTimeout(function(){n.innerHTML==="Done"&&clearProgress()},3e3)):monitorProcessing(e)},window.rpc.form_process(e)}function uploadProgress(e){var t=$("progress");if(e.lengthComputable){var n=Math.round(e.loaded*100/e.total);t.innerHTML="Uploading: "+n.toString()+"%"}}function uploadComplete(e){var t=$("upload"),n=$("progress");window.needToConfirm=!1;if(e!=="failed"){var r=parseInt(e,10);n.innerHTML="Processing",monitorProcessing(r)}else fileError("Error uploading file")}function clearProgress(){progress.innerHTML="&nbsp;"}function fileError(e){var t=$("fileError"),n=$("progress"),r=$("uploadFileButton");clearProgress(),t.innerHTML=e,r.disabled=!1,window.needToConfirm=!1}function deleteEntry(e){var t,n=parseInt(e.parentNode.firstElementChild.innerHTML,10);for(var r=0;r<e.parentNode.children.length;r++)if(e.parentNode.children[r].className=="name"){t=e.parentNode.children[r].innerHTML;break}var i=confirm('Are you sure you want to delete "'+t+'"? '+"This cannot be undone.");i&&(window.rpc.form_delete.on_result=function(t){var n=e.parentNode.parentNode;if(n.parentNode!==null){var r=n.rowIndex,i=n.parentNode.rows[r+1];n.parentNode.removeChild(n),i.parentNode.removeChild(i)}},window.rpc.form_delete(n))}function formGetAll(){window.rpc.form_getall.on_error=function(e){fileError("Couldn't connect to server")},window.rpc.form_getall.on_result=function(e){clearProgress();var t;for(t=0;t<e.length;++t)createEntry(e[t].id,e[t].name,e[t].date,e[t].data)},window.rpc.form_getall()}function formGetOne(e){window.rpc.form_getone.on_error=function(e){fileError("Error downloading information");var t=$("uploadFileButton");t.disabled=!1},window.rpc.form_getone.on_result=function(e){e.length==1&&createEntry(e[0].id,e[0].name,e[0].date,e[0].data);var t=$("uploadFileButton");t.disabled=!1},window.rpc.form_getone(e)}function createEntry(e,t,n,r){var i=$("forms"),s=document.createElement("span");s.className="id",s.innerHTML=e;var o=document.createElement("span");o.className="del",o.onclick=function(){deleteEntry(o)},o.innerHTML="X";var u=document.createElement("span");u.className="name",u.innerHTML=t;var a=document.createElement("span");a.className="date",a.innerHTML="&mdash; "+n;var f=i.insertRow(1);f.className="data";var l=f.insertCell(0);l.innerHTML=r;var c=i.insertRow(1);c.className="head";var h=c.insertCell(0);h.appendChild(s),h.appendChild(o),h.appendChild(u),h.appendChild(a)}function confirmExit(){if(
window.needToConfirm)return"Are you sure you want to leave this page? You will lose data if you do."}function logoutOnclick(){window.rpc.account_logout.on_error=function(e){},window.rpc.account_logout.on_result=function(e){e&&goHome()},window.rpc.account_logout()}function http(e,t,n,r,i,s){var o;try{o=new XMLHttpRequest}catch(u){try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(u){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(u){return}}}if(typeof t=="undefined")return;typeof n=="undefined"&&(n=function(){}),typeof r=="undefined"&&(r=function(){}),typeof i=="undefined"&&(i=function(){}),typeof s=="undefined"&&(s=null),typeof o.addEventListener=="function"?(o.addEventListener("progress",r,!1),o.addEventListener("load",function(e){e.target.status===200?t(e.target.responseText):n(e.target.responseText)},!1),o.addEventListener("error",function(e){n(e.target.responseText)},!1),o.addEventListener("abort",i,!1)):o.onreadystatechange=function(){o.readyState===4&&(o.status===200?t(o.responseText):n(o.responseText))},o.open("POST",e,!0),o.send(s)}function goHome(){window.location.replace("/")}var $=function(e){return document.getElementById(e)};window.onload=function(){window.needToConfirm=!1,window.onbeforeunload=confirmExit,window.rpc=new JsonRPC("/rpc",["account_login","account_logout","account_create","account_update","account_delete","form_process","form_delete","form_rename","form_getall","form_getone"],[]);if($("logout")!==null){var e=$("logout");e.onclick=logoutOnclick}if($("account")!==null){var t=$("forgotlink");t.onmouseover=forgotMouseOver,t.onmouseout=forgotMouseOut,t.onclick=function(){return!1};var n=$("account");n.onsubmit=accountSubmit;var r=$("new_account");r.onsubmit=newAccountSubmit}if($("update_account")!==null){var i=$("update_account");i.onsubmit=updateAccountSubmit;var s=$("delete_account");s.onclick=deleteAccount}if($("upload")!==null){var o=$("uploadFile");o.onchange=fileSelected;var u=$("upload");u.onsubmit=uploadFile,progress.innerHTML="Loading...",formGetAll()}};
